#!/usr/bin/env bash
set -euo pipefail

name=""
init_flag=""
while [[ $# -gt 0 ]]; do
  case "$1" in
    --init) init_flag="--init" ;;
    --) shift; break ;;
    -*) echo "Unknown option: $1" >&2; exit 1 ;;
    *) if [ -z "$name" ]; then name="$1"; else break; fi ;;
  esac
  shift
done

if [ -z "$name" ]; then
  name="env-$(date +%Y%m%d-%H%M%S)"
fi

ssenv create "$name" $init_flag
if [ "$#" -gt 0 ]; then
  exec ssenv enter "$name" -- "$@"
fi
exec ssenv enter "$name"
