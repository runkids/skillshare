services:
  sandbox-offline:
    profiles:
      - offline
    build:
      context: .
      dockerfile: docker/sandbox/Dockerfile
    working_dir: /workspace
    command:
      - ./scripts/test.sh
    network_mode: none
    environment:
      HOME: /tmp
      GOCACHE: /go/build-cache
    volumes:
      - .:/workspace
      - go-mod-cache:/go/pkg/mod
      - go-build-cache:/go/build-cache

  sandbox-online:
    profiles:
      - online
    build:
      context: .
      dockerfile: docker/sandbox/Dockerfile
    working_dir: /workspace
    command:
      - ./scripts/test.sh
    environment:
      HOME: /tmp
      GOCACHE: /go/build-cache
    volumes:
      - .:/workspace
      - go-mod-cache:/go/pkg/mod
      - go-build-cache:/go/build-cache

  sandbox-playground:
    profiles:
      - playground
    build:
      context: .
      dockerfile: docker/sandbox/Dockerfile
    working_dir: /workspace
    command:
      - sleep
      - infinity
    ports:
      - "19420:19420"
    environment:
      HOME: /sandbox-home
      GOCACHE: /go/build-cache
      PATH: /sandbox-home/.local/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    volumes:
      - .:/workspace
      - go-mod-cache:/go/pkg/mod
      - go-build-cache:/go/build-cache
      - playground-home:/sandbox-home

volumes:
  go-mod-cache:
  go-build-cache:
  playground-home:
